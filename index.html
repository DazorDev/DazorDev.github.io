<!doctype html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Love ya my little strawberry</title>

	<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
	<link rel="stylesheet" href="src/styles.css" type="text/css" />

</head>

<body>

	<div id="page">
		<main>
			<div class="wrapper">

				<div class="puzzle">
					<div data-nonogram-puzzle-grid></div>
				</div>
				<div class="game-controls">
					<button onClick="solvePuzzle()">Solve This puzzle</button>
				</div>
			</div>

		</main>

	</div>
	<script type="module">
		import { Creator, Gui } from './src/index.js';
		const my_love =
			[
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
				[1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1],
				[1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
				[1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0],
				[1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
			]
		const creator = new Creator();
		const puzzle = creator.createFromGrid(my_love)
		const gui = new Gui('src/themes/default');
		gui.draw(puzzle);

		async function goThroughPuzzle(time) {
			for(var i=0;i<25*25;i++) {
				var cell = puzzle.getCellByIndex(i);
				cell.userSolution = cell.solution === 1 ? 0 : 1;
				var gui_cell = gui.gridContainer.querySelector('[data-index="'+i+'"]')
				gui_cell.classList.toggle('flipped');
				if(cell.solution === 0) {
					gui_cell.classList.add('user-solved', 'user-positive');
					gui.drawPreview('userSolution');
					await new Promise(r => setTimeout(r, time));
					continue;
				} 
				gui_cell.classList.add('user-solved', 'user-negative');
				gui.drawPreview('userSolution');
				await new Promise(r => setTimeout(r, time));
			}
		}

		async function flipRows(time) {
			var index = 0;
			for(var i=0; i<25;i++) {
				var row = puzzle.getRowCells(i)
				for(var j=0; j<25; j++) {
					var gui_cell = gui.gridContainer.querySelector('[data-index="'+index+'"]')
					index++;
					gui_cell.classList.toggle('flipped');
					if(row[j].userSolution === 1) {
						gui_cell.classList.remove('user-positive')
						gui_cell.classList.add('user-negative')
					} else {
						gui_cell.classList.remove('user-negative')
						gui_cell.classList.add('user-positive')
					}
					row[j].userSolution = row[j].solution;
					console.log(row[j].solution)
				}
				gui.drawPreview('userSolution');
				await new Promise(r => setTimeout(r, time));
			}
		}

		async function solvePuzzle() {
			await goThroughPuzzle(25)
			await flipRows(50)
			gui.drawPreview('solution');
			gui._showPuzzleSolved();
		}

		window.solvePuzzle = solvePuzzle;
	</script>
</body>
</html>
